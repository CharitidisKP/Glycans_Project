```{r Load the libraries}
library(readxl)
library(tidyverse)
# library()
# library()
# library()
# library()

```

```{r}

GLM_Data <- read_xlsx("~/SLE/Glycans/Output_Data/Figure_5_GLMs/Figure_5_GLM_Firth_Delta.xlsx")
HR_Data_Uni <- read_xlsx("~/SLE/Glycans/Output_Data/Figure_6_Cox/Figure_6_Cox_Univariable.xlsx")
HR_Data_Multi <- read_xlsx("~/SLE/Glycans/Output_Data/Figure_6_Cox/Figure_6_Cox_Multivariable_Sign_Markers_Firth.xlsx")

GLM_Data %>% filter(p.value < 0.05)
HR_Data_Uni %>% filter(p.value < 0.05) 
HR_Data_Multi %>% filter(p.value < 0.05) 

```

```{r}

Glycosylations <- read_excel("~/SLE/Glycans/Glycosylation_Data_Corrected.xlsx") 

Glycosylations %>%
  mutate(Fucose = F > 0,
         Compartment = case_when(str_detect(Protein, "IgG.*Fc") ~ "IgG_Fc",
                                 str_detect(Protein, "IgG.*Fab") ~ "IgG_Fab", 
                                 TRUE ~ Protein)) %>%
  select(Marker, Protein, Glycosylation_Site, Compartment, N, H, S, F, Fucose, Antennae_Class)


```

```{r}

Glycosylations <- read_excel("~/SLE/Glycans/Glycosylation_Data_Corrected.xlsx")

Glycosylations %>% 
  filter(Significant_HRs_Uni_Deltas == "Yes")
```

```{r}

Glycan_Annotations <- Glycosylations %>% 
  select(Origin, Marker, N, H, S, F) %>% 
  mutate(.multiple = (!is.na(N) & N == 0) | (!is.na(H) & H == 0), 
         Glycan_Annotation = case_when(.multiple ~ paste0(Marker, " - Multiple Structures"), 
         TRUE ~ paste0(if_else(!is.na(N) & N > 0, paste0("N", N), ""), 
                       if_else(!is.na(H) & H > 0, paste0("H", H), ""), 
                       if_else(S > 0, paste0("S", S), ""), 
                       if_else(F > 0, paste0("F", F), "")))) %>% 
  select(-.multiple)

write_xlsx(x = Glycan_Annotations, path = "~/SLE/Glycans/Output_Data/Gl_annotations.xlsx")

```



